// Vector font for oscilloscope display
// Simplified, uniform glyphs designed on a 5x7 grid

const CHAR_WIDTH = 5;
const CHAR_HEIGHT = 7;

// Helper to normalize coordinates from grid to 0-1 range
function n(x, y) {
    return [x / CHAR_WIDTH, 1 - y / CHAR_HEIGHT];
}

function stroke(...points) {
    return points.map(([x, y]) => n(x, y));
}

const baseGlyphs = {
    ' ': [],
    'A': [stroke([0, 7], [2.5, 0], [5, 7]), stroke([1, 4], [4, 4])],
    'B': [stroke([0, 0], [0, 7], [3.5, 7], [4.5, 6], [4.5, 5], [3.5, 4], [0, 4]), stroke([0, 4], [3.5, 4], [4.5, 3], [4.5, 1], [3.5, 0], [0, 0])],
    'C': [stroke([5, 1], [4, 0], [1, 0], [0, 1], [0, 6], [1, 7], [4, 7], [5, 6])],
    'D': [stroke([0, 0], [0, 7], [3.5, 7], [5, 5.5], [5, 1.5], [3.5, 0], [0, 0])],
    'E': [stroke([5, 0], [0, 0], [0, 7], [5, 7]), stroke([0, 3.5], [3.5, 3.5])],
    'F': [stroke([5, 0], [0, 0], [0, 7]), stroke([0, 3.5], [3.5, 3.5])],
    'G': [stroke([5, 1], [4, 0], [1, 0], [0, 1], [0, 6], [1, 7], [4, 7], [5, 6], [5, 3.5], [3, 3.5])],
    'H': [stroke([0, 0], [0, 7]), stroke([5, 0], [5, 7]), stroke([0, 3.5], [5, 3.5])],
    'I': [stroke([1, 0], [4, 0]), stroke([2.5, 0], [2.5, 7]), stroke([1, 7], [4, 7])],
    'J': [stroke([5, 0], [2, 0]), stroke([3.5, 0], [3.5, 6], [2.5, 7], [1.5, 7], [0.5, 6])],
    'K': [stroke([0, 0], [0, 7]), stroke([5, 0], [0, 4], [5, 7])],
    'L': [stroke([0, 0], [0, 7], [5, 7])],
    'M': [stroke([0, 7], [0, 0], [2.5, 3], [5, 0], [5, 7])],
    'N': [stroke([0, 7], [0, 0], [5, 7], [5, 0])],
    'O': [stroke([1, 0], [4, 0], [5, 1], [5, 6], [4, 7], [1, 7], [0, 6], [0, 1], [1, 0])],
    'P': [stroke([0, 7], [0, 0], [3.5, 0], [4.5, 1], [4.5, 3], [3.5, 4], [0, 4])],
    'Q': [stroke([1, 0], [4, 0], [5, 1], [5, 6], [4, 7], [1, 7], [0, 6], [0, 1], [1, 0]), stroke([3, 5], [5, 7])],
    'R': [stroke([0, 7], [0, 0], [3.5, 0], [4.5, 1], [4.5, 3], [3.5, 4], [0, 4]), stroke([0, 4], [4.5, 7])],
    'S': [stroke([5, 1], [4, 0], [1, 0], [0, 1], [0, 3], [1, 4], [4, 5], [5, 6], [4, 7], [1, 7], [0, 6])],
    'T': [stroke([0, 0], [5, 0]), stroke([2.5, 0], [2.5, 7])],
    'U': [stroke([0, 0], [0, 6], [1, 7], [4, 7], [5, 6], [5, 0])],
    'V': [stroke([0, 0], [2.5, 7], [5, 0])],
    'W': [stroke([0, 0], [1.5, 7], [2.5, 4], [3.5, 7], [5, 0])],
    'X': [stroke([0, 0], [5, 7]), stroke([5, 0], [0, 7])],
    'Y': [stroke([0, 0], [2.5, 4], [5, 0]), stroke([2.5, 4], [2.5, 7])],
    'Z': [stroke([0, 0], [5, 0], [0, 7], [5, 7])],
    '0': [stroke([1, 0], [4, 0], [5, 1], [5, 6], [4, 7], [1, 7], [0, 6], [0, 1], [1, 0]), stroke([1, 6], [4, 1])],
    '1': [stroke([1.5, 1], [2.5, 0], [2.5, 7]), stroke([1, 7], [4, 7])],
    '2': [stroke([0, 1], [1, 0], [4, 0], [5, 1], [5, 2.5], [0, 7], [5, 7])],
    '3': [stroke([0, 1], [1, 0], [4, 0], [5, 1], [5, 2.5], [4, 3.5], [2.5, 3.5], [4, 4.5], [5, 5.5], [5, 6], [4, 7], [1, 7], [0, 6])],
    '4': [stroke([4, 7], [4, 0]), stroke([4, 3], [0, 3], [4, 7])],
    '5': [stroke([5, 0], [0, 0], [0, 3.5], [3.5, 3.5], [5, 5], [5, 6], [4, 7], [1, 7], [0, 6])],
    '6': [stroke([5, 1.5], [4, 0], [1, 0], [0, 1.5], [0, 5.5], [1, 7], [4, 7], [5, 6], [5, 5], [4, 4], [1, 4])],
    '7': [stroke([0, 0], [5, 0], [2, 7])],
    '8': [stroke([1, 0], [4, 0], [5, 1], [5, 2.5], [4, 3.5], [1, 3.5], [0, 2.5], [0, 1], [1, 0]), stroke([1, 3.5], [4, 3.5], [5, 4.5], [5, 6], [4, 7], [1, 7], [0, 6], [0, 4.5], [1, 3.5])],
    '9': [stroke([1, 7], [4, 7], [5, 6], [5, 2], [4, 1], [1, 1], [0, 2], [0, 3], [1, 4], [5, 4])],
    '.': [stroke([2.5, 6.5], [2.5, 7])],
    ',': [stroke([2.5, 6], [2, 7], [1.5, 8])],
    '!': [stroke([2.5, 0], [2.5, 5]), stroke([2.5, 6.5], [2.5, 7])],
    '?': [stroke([0, 1], [1, 0], [3.5, 0], [5, 1], [5, 2.5], [4, 3.5], [2.5, 4], [2.5, 5]), stroke([2.5, 6.5], [2.5, 7])],
    ':': [stroke([2.5, 2], [2.5, 2.5]), stroke([2.5, 5], [2.5, 5.5])],
    ';': [stroke([2.5, 2], [2.5, 2.5]), stroke([2.5, 5.5], [2, 6.5], [1.5, 7.5])],
    '-': [stroke([1, 3.5], [4, 3.5])],
    '+': [stroke([1, 3.5], [4, 3.5]), stroke([2.5, 1.5], [2.5, 5.5])],
    '=': [stroke([0.5, 2.5], [4.5, 2.5]), stroke([0.5, 4.5], [4.5, 4.5])],
    '*': [stroke([0.5, 2], [4.5, 5]), stroke([4.5, 2], [0.5, 5]), stroke([2.5, 1.5], [2.5, 5.5])],
    '/': [stroke([5, 0], [0, 7])],
    '\\': [stroke([0, 0], [5, 7])],
    '_': [stroke([0, 7], [5, 7])],
    '(': [stroke([3.5, 0], [2.5, 1], [2, 3.5], [2.5, 6], [3.5, 7])],
    ')': [stroke([1.5, 0], [2.5, 1], [3, 3.5], [2.5, 6], [1.5, 7])],
    '[': [stroke([3.5, 0], [1.5, 0], [1.5, 7], [3.5, 7])],
    ']': [stroke([1.5, 0], [3.5, 0], [3.5, 7], [1.5, 7])],
    '{': [stroke([3.5, 0], [2.5, 0.5], [2.2, 3.5], [2.5, 6.5], [3.5, 7])],
    '}': [stroke([1.5, 0], [2.5, 0.5], [2.8, 3.5], [2.5, 6.5], [1.5, 7])],
    '<': [stroke([4, 1], [1, 3.5], [4, 6])],
    '>': [stroke([1, 1], [4, 3.5], [1, 6])],
    '"': [stroke([1.5, 0], [1.5, 2]), stroke([3.5, 0], [3.5, 2])],
    "'": [stroke([2.5, 0], [2.5, 2])],
    '`': [stroke([2, 0], [3, 1.5])],
    '#': [stroke([1.5, 1], [1.5, 6]), stroke([3.5, 1], [3.5, 6]), stroke([0.5, 2.5], [4.5, 2.5]), stroke([0.5, 4.5], [4.5, 4.5])],
    '$': [stroke([4.5, 1], [3.5, 0], [1.5, 0], [0.5, 1], [0.5, 2.5], [1.5, 3.5], [3.5, 4], [4.5, 5], [4.5, 6], [3.5, 7], [1.5, 7], [0.5, 6]), stroke([2.5, -0.5], [2.5, 7.5])],
    '%': [stroke([5, 0], [0, 7]), stroke([1, 0], [0, 0.5], [0, 1.5], [1, 2], [2, 1.5], [2, 0.5], [1, 0]), stroke([4, 5], [3, 5.5], [3, 6.5], [4, 7], [5, 6.5], [5, 5.5], [4, 5])],
    '&': [stroke([5, 6], [4, 7], [2.5, 7], [1, 6], [1, 5], [3.5, 2], [2.5, 1], [1.5, 1], [0.5, 2], [0.5, 3], [1.5, 4], [5, 0])],
    '@': [stroke([4, 4], [3, 3], [2, 3], [1, 4], [1, 5.5], [2, 6.5], [3.5, 6.5], [4.5, 5.5], [4.5, 2.5], [3.5, 1.5], [1.5, 1.5], [0.5, 2.5], [0.5, 5.5], [1.5, 6.5], [4, 6.5], [5, 6])],
    '^': [stroke([0.5, 3], [2.5, 1], [4.5, 3])],
    '~': [stroke([0, 4], [1.5, 3], [3, 3.5], [4.5, 3])],
    '|': [stroke([2.5, 0], [2.5, 7])]
};

export const vectorFont = { ...baseGlyphs };

for (const char of 'abcdefghijklmnopqrstuvwxyz') {
    const upper = char.toUpperCase();
    vectorFont[char] = baseGlyphs[upper] || [];
}

export function getCharWidth() {
    return 1.0;
}

export function getCharHeight() {
    return 1.4;
}

export function getCharStrokes(char) {
    if (vectorFont[char]) {
        return vectorFont[char];
    }
    if (typeof char === 'string') {
        const upper = char.toUpperCase();
        if (vectorFont[upper]) {
            return vectorFont[upper];
        }
    }
    return vectorFont['?'] || [];
}

export function hasChar(char) {
    if (vectorFont[char]) {
        return true;
    }
    if (typeof char === 'string' && vectorFont[char.toUpperCase()]) {
        return true;
    }
    return false;
}

export function getAvailableChars() {
    return Object.keys(vectorFont);
}
