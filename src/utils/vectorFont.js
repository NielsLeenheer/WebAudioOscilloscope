// Vector font for oscilloscope display
// Simplified, uniform glyphs designed on a 5x7 grid

const CHAR_WIDTH = 5;
const CHAR_HEIGHT = 7;
const DEFAULT_CHAR_WIDTH = 1.0;

// Helper to normalize coordinates from grid to 0-1 range
function n(x, y) {
    return [x / CHAR_WIDTH, 1 - y / CHAR_HEIGHT];
}

function stroke(...points) {
    return points.map(([x, y]) => n(x, y));
}

function glyph(width, strokes = []) {
    return { width, strokes };
}

const glyphs = {
    ' ': glyph(0.6, []),
    'A': glyph(1.0, [stroke([0, 7], [2.5, 0], [5, 7]), stroke([1, 4], [4, 4])]),
    'B': glyph(1.0, [stroke([0, 0], [0, 7], [3.5, 7], [4.5, 6], [4.5, 5], [3.5, 4], [0, 4]), stroke([0, 4], [3.5, 4], [4.5, 3], [4.5, 1], [3.5, 0], [0, 0])]),
    'C': glyph(1.0, [stroke([5, 1], [4, 0], [1, 0], [0, 1], [0, 6], [1, 7], [4, 7], [5, 6])]),
    'D': glyph(1.0, [stroke([0, 0], [0, 7], [3.5, 7], [5, 5.5], [5, 1.5], [3.5, 0], [0, 0])]),
    'E': glyph(1.0, [stroke([5, 0], [0, 0], [0, 7], [5, 7]), stroke([0, 3.5], [3.5, 3.5])]),
    'F': glyph(1.0, [stroke([5, 0], [0, 0], [0, 7]), stroke([0, 3.5], [3.5, 3.5])]),
    'G': glyph(1.0, [stroke([5, 1], [4, 0], [1, 0], [0, 1], [0, 6], [1, 7], [4, 7], [5, 6], [5, 3.5], [3, 3.5])]),
    'H': glyph(1.0, [stroke([0, 0], [0, 7]), stroke([5, 0], [5, 7]), stroke([0, 3.5], [5, 3.5])]),
    'I': glyph(0.65, [stroke([1, 0], [4, 0]), stroke([2.5, 0], [2.5, 7]), stroke([1, 7], [4, 7])]),
    'J': glyph(0.85, [stroke([5, 0], [2, 0]), stroke([3.5, 0], [3.5, 6], [2.5, 7], [1.5, 7], [0.5, 6])]),
    'K': glyph(1.0, [stroke([0, 0], [0, 7]), stroke([5, 0], [0, 4], [5, 7])]),
    'L': glyph(0.9, [stroke([0, 0], [0, 7], [5, 7])]),
    'M': glyph(1.2, [stroke([0, 7], [0, 0], [2.5, 3], [5, 0], [5, 7])]),
    'N': glyph(1.05, [stroke([0, 7], [0, 0], [5, 7], [5, 0])]),
    'O': glyph(1.0, [stroke([1, 0], [4, 0], [5, 1], [5, 6], [4, 7], [1, 7], [0, 6], [0, 1], [1, 0])]),
    'P': glyph(1.0, [stroke([0, 7], [0, 0], [3.5, 0], [4.5, 1], [4.5, 3], [3.5, 4], [0, 4])]),
    'Q': glyph(1.05, [stroke([1, 0], [4, 0], [5, 1], [5, 6], [4, 7], [1, 7], [0, 6], [0, 1], [1, 0]), stroke([3, 5], [5, 7])]),
    'R': glyph(1.0, [stroke([0, 7], [0, 0], [3.5, 0], [4.5, 1], [4.5, 3], [3.5, 4], [0, 4]), stroke([0, 4], [4.5, 7])]),
    'S': glyph(1.0, [stroke([5, 1], [4, 0], [1, 0], [0, 1], [0, 3], [1, 4], [4, 5], [5, 6], [4, 7], [1, 7], [0, 6])]),
    'T': glyph(0.95, [stroke([0, 0], [5, 0]), stroke([2.5, 0], [2.5, 7])]),
    'U': glyph(1.0, [stroke([0, 0], [0, 6], [1, 7], [4, 7], [5, 6], [5, 0])]),
    'V': glyph(1.0, [stroke([0, 0], [2.5, 7], [5, 0])]),
    'W': glyph(1.25, [stroke([0, 0], [1.5, 7], [2.5, 4], [3.5, 7], [5, 0])]),
    'X': glyph(1.0, [stroke([0, 0], [5, 7]), stroke([5, 0], [0, 7])]),
    'Y': glyph(1.0, [stroke([0, 0], [2.5, 4], [5, 0]), stroke([2.5, 4], [2.5, 7])]),
    'Z': glyph(1.0, [stroke([0, 0], [5, 0], [0, 7], [5, 7])]),
    '0': glyph(1.0, [stroke([1, 0], [4, 0], [5, 1], [5, 6], [4, 7], [1, 7], [0, 6], [0, 1], [1, 0]), stroke([1, 6], [4, 1])]),
    '1': glyph(0.75, [stroke([1.5, 1], [2.5, 0], [2.5, 7]), stroke([1, 7], [4, 7])]),
    '2': glyph(1.0, [stroke([0, 1], [1, 0], [4, 0], [5, 1], [5, 2.5], [0, 7], [5, 7])]),
    '3': glyph(1.0, [stroke([0, 1], [1, 0], [4, 0], [5, 1], [5, 2.5], [4, 3.5], [2.5, 3.5], [4, 4.5], [5, 5.5], [5, 6], [4, 7], [1, 7], [0, 6])]),
    '4': glyph(0.95, [stroke([4, 7], [4, 0]), stroke([4, 3], [0, 3], [4, 7])]),
    '5': glyph(1.0, [stroke([5, 0], [0, 0], [0, 3.5], [3.5, 3.5], [5, 5], [5, 6], [4, 7], [1, 7], [0, 6])]),
    '6': glyph(1.0, [stroke([5, 1.5], [4, 0], [1, 0], [0, 1.5], [0, 5.5], [1, 7], [4, 7], [5, 6], [5, 5], [4, 4], [1, 4])]),
    '7': glyph(0.95, [stroke([0, 0], [5, 0], [2, 7])]),
    '8': glyph(1.0, [stroke([1, 0], [4, 0], [5, 1], [5, 2.5], [4, 3.5], [1, 3.5], [0, 2.5], [0, 1], [1, 0]), stroke([1, 3.5], [4, 3.5], [5, 4.5], [5, 6], [4, 7], [1, 7], [0, 6], [0, 4.5], [1, 3.5])]),
    '9': glyph(1.0, [stroke([1, 7], [4, 7], [5, 6], [5, 2], [4, 1], [1, 1], [0, 2], [0, 3], [1, 4], [5, 4])]),
    '.': glyph(0.35, [stroke([2.5, 6.5], [2.5, 7])]),
    ',': glyph(0.35, [stroke([2.5, 6], [2, 7], [1.5, 8])]),
    '!': glyph(0.4, [stroke([2.5, 0], [2.5, 5]), stroke([2.5, 6.5], [2.5, 7])]),
    '?': glyph(0.95, [stroke([0, 1], [1, 0], [3.5, 0], [5, 1], [5, 2.5], [4, 3.5], [2.5, 4], [2.5, 5]), stroke([2.5, 6.5], [2.5, 7])]),
    ':': glyph(0.45, [stroke([2.5, 2], [2.5, 2.5]), stroke([2.5, 5], [2.5, 5.5])]),
    ';': glyph(0.45, [stroke([2.5, 2], [2.5, 2.5]), stroke([2.5, 5.5], [2, 6.5], [1.5, 7.5])]),
    '-': glyph(0.7, [stroke([1, 3.5], [4, 3.5])]),
    '+': glyph(0.9, [stroke([1, 3.5], [4, 3.5]), stroke([2.5, 1.5], [2.5, 5.5])]),
    '=': glyph(0.95, [stroke([0.5, 2.5], [4.5, 2.5]), stroke([0.5, 4.5], [4.5, 4.5])]),
    '*': glyph(0.95, [stroke([0.5, 2], [4.5, 5]), stroke([4.5, 2], [0.5, 5]), stroke([2.5, 1.5], [2.5, 5.5])]),
    '/': glyph(0.8, [stroke([5, 0], [0, 7])]),
    '\\': glyph(0.8, [stroke([0, 0], [5, 7])]),
    '_': glyph(1.1, [stroke([0, 7], [5, 7])]),
    '(': glyph(0.6, [stroke([3.5, 0], [2.5, 1], [2, 3.5], [2.5, 6], [3.5, 7])]),
    ')': glyph(0.6, [stroke([1.5, 0], [2.5, 1], [3, 3.5], [2.5, 6], [1.5, 7])]),
    '[': glyph(0.6, [stroke([3.5, 0], [1.5, 0], [1.5, 7], [3.5, 7])]),
    ']': glyph(0.6, [stroke([1.5, 0], [3.5, 0], [3.5, 7], [1.5, 7])]),
    '{': glyph(0.7, [stroke([3.5, 0], [2.5, 0.5], [2.2, 3.5], [2.5, 6.5], [3.5, 7])]),
    '}': glyph(0.7, [stroke([1.5, 0], [2.5, 0.5], [2.8, 3.5], [2.5, 6.5], [1.5, 7])]),
    '<': glyph(0.9, [stroke([4, 1], [1, 3.5], [4, 6])]),
    '>': glyph(0.9, [stroke([1, 1], [4, 3.5], [1, 6])]),
    '"': glyph(0.7, [stroke([1.5, 0], [1.5, 2]), stroke([3.5, 0], [3.5, 2])]),
    "'": glyph(0.35, [stroke([2.5, 0], [2.5, 2])]),
    '`': glyph(0.45, [stroke([2, 0], [3, 1.5])]),
    '#': glyph(1.0, [stroke([1.5, 1], [1.5, 6]), stroke([3.5, 1], [3.5, 6]), stroke([0.5, 2.5], [4.5, 2.5]), stroke([0.5, 4.5], [4.5, 4.5])]),
    '$': glyph(1.0, [stroke([4.5, 1], [3.5, 0], [1.5, 0], [0.5, 1], [0.5, 2.5], [1.5, 3.5], [3.5, 4], [4.5, 5], [4.5, 6], [3.5, 7], [1.5, 7], [0.5, 6]), stroke([2.5, -0.5], [2.5, 7.5])]),
    '%': glyph(1.2, [stroke([5, 0], [0, 7]), stroke([1, 0], [0, 0.5], [0, 1.5], [1, 2], [2, 1.5], [2, 0.5], [1, 0]), stroke([4, 5], [3, 5.5], [3, 6.5], [4, 7], [5, 6.5], [5, 5.5], [4, 5])]),
    '&': glyph(1.1, [stroke([5, 6], [4, 7], [2.5, 7], [1, 6], [1, 5], [3.5, 2], [2.5, 1], [1.5, 1], [0.5, 2], [0.5, 3], [1.5, 4], [5, 0])]),
    '@': glyph(1.1, [stroke([4, 4], [3, 3], [2, 3], [1, 4], [1, 5.5], [2, 6.5], [3.5, 6.5], [4.5, 5.5], [4.5, 2.5], [3.5, 1.5], [1.5, 1.5], [0.5, 2.5], [0.5, 5.5], [1.5, 6.5], [4, 6.5], [5, 6])]),
    '^': glyph(0.8, [stroke([0.5, 3], [2.5, 1], [4.5, 3])]),
    '~': glyph(1.0, [stroke([0, 4], [1.5, 3], [3, 3.5], [4.5, 3])]),
    '|': glyph(0.4, [stroke([2.5, 0], [2.5, 7])]),

    // Lowercase glyphs
    'a': glyph(0.95, [
        stroke([4.5, 5], [4.5, 6.5], [3.5, 7], [1.5, 7], [0.5, 6], [0.5, 5], [1.5, 4], [3.5, 4], [4.5, 5]),
        stroke([4.5, 4], [4.5, 7])
    ]),
    'b': glyph(1.0, [
        stroke([0.5, 0], [0.5, 7]),
        stroke([0.5, 4], [3, 4], [4.5, 5], [4.5, 6], [3, 7], [0.5, 7])
    ]),
    'c': glyph(0.9, [
        stroke([4.5, 5], [3.5, 4], [1.5, 4], [0.5, 5], [0.5, 6], [1.5, 7], [3.5, 7], [4.5, 6])
    ]),
    'd': glyph(1.0, [
        stroke([4.5, 0], [4.5, 7]),
        stroke([4.5, 4], [3, 4], [1.5, 4], [0.5, 5], [0.5, 6], [1.5, 7], [3, 7], [4.5, 6])
    ]),
    'e': glyph(0.95, [
        stroke([4.5, 5.5], [3.5, 4], [1.5, 4], [0.5, 5], [0.5, 6], [1.5, 7], [3.5, 7], [4.5, 6]),
        stroke([0.5, 5.5], [4.5, 5.5])
    ]),
    'f': glyph(0.8, [
        stroke([3.5, 0], [2.5, 0], [1.5, 1], [1.5, 7]),
        stroke([0.5, 3.5], [3.5, 3.5]),
        stroke([1.5, 7], [3.5, 7])
    ]),
    'g': glyph(0.95, [
        stroke([4.5, 5], [4.5, 6.5], [3.5, 7], [1.5, 7], [0.5, 6], [0.5, 5], [1.5, 4], [3.5, 4], [4.5, 5]),
        stroke([4.5, 4], [4.5, 8], [3.5, 8.5], [1.5, 8.5], [0.5, 8])
    ]),
    'h': glyph(1.0, [
        stroke([0.5, 0], [0.5, 7]),
        stroke([0.5, 5], [1.5, 4], [3.5, 4], [4.5, 5], [4.5, 7])
    ]),
    'i': glyph(0.35, [
        stroke([2.5, 4], [2.5, 7]),
        stroke([2.5, 2], [2.5, 2.5])
    ]),
    'j': glyph(0.4, [
        stroke([3.5, 4], [3.5, 8], [2.5, 9], [1.5, 9], [0.5, 8]),
        stroke([3.5, 2], [3.5, 2.5])
    ]),
    'k': glyph(0.95, [
        stroke([0.5, 0], [0.5, 7]),
        stroke([4.5, 4], [0.5, 5.5], [4.5, 7])
    ]),
    'l': glyph(0.35, [
        stroke([2.5, 0], [2.5, 7])
    ]),
    'm': glyph(1.2, [
        stroke([0.5, 4], [0.5, 7]),
        stroke([0.5, 5], [1.5, 4], [2.5, 4], [3.5, 5], [3.5, 7]),
        stroke([3.5, 5], [4.5, 4], [4.5, 7])
    ]),
    'n': glyph(1.0, [
        stroke([0.5, 4], [0.5, 7]),
        stroke([0.5, 5], [1.5, 4], [3.5, 4], [4.5, 5], [4.5, 7])
    ]),
    'o': glyph(0.95, [
        stroke([1.5, 4], [3.5, 4], [4.5, 5], [4.5, 6], [3.5, 7], [1.5, 7], [0.5, 6], [0.5, 5], [1.5, 4])
    ]),
    'p': glyph(1.0, [
        stroke([0.5, 4], [0.5, 8.5]),
        stroke([0.5, 4], [3.5, 4], [4.5, 5], [4.5, 6], [3.5, 7], [0.5, 7])
    ]),
    'q': glyph(1.0, [
        stroke([4.5, 4], [4.5, 8.5]),
        stroke([4.5, 4], [3, 4], [1.5, 4], [0.5, 5], [0.5, 6], [1.5, 7], [4.5, 7])
    ]),
    'r': glyph(0.8, [
        stroke([0.5, 4], [0.5, 7]),
        stroke([0.5, 5], [1.5, 4], [3, 4], [4.5, 5])
    ]),
    's': glyph(0.9, [
        stroke([4.5, 5], [3.5, 4], [1.5, 4], [0.5, 5], [1.5, 6], [3.5, 6], [4.5, 7], [3.5, 8], [1.5, 8], [0.5, 7])
    ]),
    't': glyph(0.8, [
        stroke([2.5, 0], [2.5, 6.5], [1.5, 7], [0.5, 7]),
        stroke([0.5, 4], [4.5, 4])
    ]),
    'u': glyph(0.95, [
        stroke([0.5, 4], [0.5, 6.5], [1.5, 7], [3.5, 7], [4.5, 6.5], [4.5, 4])
    ]),
    'v': glyph(0.95, [
        stroke([0.5, 4], [2.5, 7], [4.5, 4])
    ]),
    'w': glyph(1.2, [
        stroke([0.5, 4], [1.5, 7], [2.5, 5.5], [3.5, 7], [4.5, 4])
    ]),
    'x': glyph(0.95, [
        stroke([0.5, 4], [4.5, 7]),
        stroke([4.5, 4], [0.5, 7])
    ]),
    'y': glyph(0.95, [
        stroke([0.5, 4], [2.5, 7], [4.5, 4]),
        stroke([2.5, 7], [2.5, 8.5], [1.5, 9], [0.5, 9])
    ]),
    'z': glyph(0.9, [
        stroke([0.5, 4], [4.5, 4], [0.5, 7], [4.5, 7])
    ])
};

export const vectorFont = { ...glyphs };

for (const char of 'abcdefghijklmnopqrstuvwxyz') {
    const upper = char.toUpperCase();
    if (!vectorFont[char] && vectorFont[upper]) {
        const upperGlyph = vectorFont[upper];
        vectorFont[char] = {
            width: upperGlyph.width,
            strokes: upperGlyph.strokes
        };
    }
}

function resolveGlyph(char) {
    if (!char) {
        return null;
    }
    if (vectorFont[char]) {
        return vectorFont[char];
    }
    if (typeof char === 'string') {
        const upper = char.toUpperCase();
        if (vectorFont[upper]) {
            return vectorFont[upper];
        }
    }
    return null;
}

export function getCharWidth(char) {
    const glyph = resolveGlyph(char);
    return glyph ? glyph.width : DEFAULT_CHAR_WIDTH;
}

export function getCharHeight() {
    return 1.4;
}

export function getCharStrokes(char) {
    const glyph = resolveGlyph(char);
    if (glyph) {
        return glyph.strokes;
    }
    return vectorFont['?']?.strokes || [];
}

export function hasChar(char) {
    return resolveGlyph(char) !== null;
}

export function getAvailableChars() {
    return Object.keys(vectorFont);
}
